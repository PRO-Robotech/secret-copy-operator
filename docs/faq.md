# FAQ

## Общие вопросы

### Что происходит при удалении source секрета?

Копия в целевом кластере **НЕ удаляется**. Оператор игнорирует события удаления. Это сделано намеренно для безопасности — случайное удаление в management кластере не должно ломать workload кластеры.

Для удаления копии необходимо удалить её вручную в целевом кластере.

### Как часто происходит синхронизация?

Синхронизация происходит при:
- Создании секрета с лейблом `secret-copy.in-cloud.io=true`
- Изменении секрета (data или annotations)
- Ошибке предыдущей синхронизации (requeue через 30 секунд)

Периодической синхронизации нет — только по событиям.

### Можно ли копировать один секрет в несколько кластеров?

Нет, один секрет → один целевой кластер. Для копирования в несколько кластеров создайте несколько source секретов с разными kubeconfig.

### Как работает стратегия ignore?

При `strategy.secret-copy.in-cloud.io/ifExist: "ignore"`:
- Если секрет НЕ существует в целевом кластере — создаётся
- Если секрет УЖЕ существует — пропускается, данные не обновляются

Полезно для начальной инициализации, когда не хотите перезаписывать локальные изменения.

### Сохраняются ли лейблы при копировании?

Да, лейблы копируются, **кроме** `secret-copy.in-cloud.io` — этот лейбл удаляется чтобы избежать рекурсивного копирования.

### Сохраняются ли аннотации source секрета?

Нет, аннотации source секрета НЕ копируются. На целевом секрете создаются только служебные аннотации:
- `secret-copy.in-cloud.io/sourceCluster`
- `secret-copy.in-cloud.io/sourceSecret`
- `secret-copy.in-cloud.io/copiedAt`

## Безопасность

### Можно ли ограничить в какие namespaces копировать?

На стороне оператора — нет. Ограничения нужно настраивать через RBAC в целевом кластере — дайте ServiceAccount права только на нужные namespaces.

## Производительность

### Сколько секретов может обрабатывать оператор?

Зависит от:
- Количества воркеров (`--max-concurrent-reconciles`)
- Доступности целевых кластеров
- Ресурсов оператора

При 10 воркерах и стабильных кластерах — сотни секретов без проблем.

### Что происходит при недоступности целевого кластера?

- Reconcile завершается с ошибкой
- Секрет ставится в очередь на повторную обработку через 30 секунд
- Статус обновляется на `Error: <сообщение>`
- Другие секреты продолжают обрабатываться нормально

### Влияет ли кэширование на производительность?

Да, положительно:
- Клиенты к кластерам кэшируются на 5 минут (по умолчанию)
- Не создаётся новое подключение на каждый reconcile
- Rate limiting общий для всех запросов к одному кластеру

## Интеграции

### Работает ли с cert-manager?

Да, типичный use case — копирование TLS сертификатов созданных cert-manager в workload кластеры.

### Работает ли с external-secrets?

Да, можно копировать секреты созданные external-secrets operator.

### Работает ли с sealed-secrets?

Да, но только после расшифровки. Копируется уже расшифрованный Secret, не SealedSecret.

## Миграция и обновления

### Как обновить оператор?

```bash
kubectl apply -k config/default
```

Оператор stateless — обновление безопасно, просто перезапустится новая версия.

### Что происходит при обновлении kubeconfig?

Кэш автоматически инвалидируется при изменении hash kubeconfig. Следующий reconcile создаст новый клиент.

### Можно ли откатить версию?

Да, оператор stateless. Просто разверните предыдущую версию образа.
